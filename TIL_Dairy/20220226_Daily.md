# 今日の目標

- ActionView フォームヘルパーを理解する

# 今日の積み上げ

# ActionView フォームヘルパー

- フォームとは、Webアプリで**サーバーに何かを送るときに使う**。
- 例えば、ユーザー登録の際にメールアドレス登録やパスワード登録など

フォームでは、**何を・どこに・どのように・どんなinputで送るか**定義されている。
- どこのURLに
- どのようなメソッドで
- どのようなパラメータを送るか
    - keyとvalueは何か
- フォームの種類は何か
    - HTMLのinputで指定する
    - text_fieldなどがある
    - 20種類以上もある

# form_with

```html
= form_with model: @user, url: mypage_notification_setting_path, method: :patch, local: true do |f|
  = render 'shared/error_messages', object: f.object
  .form-group
    = f.check_box :notification_on_comment
    = f.label :notification_on_comment

  .form-group
    = f.check_box :notification_on_like
    = f.label :notification_on_like

  .form-group
    = f.check_box :notification_on_follow
    = f.label :notification_on_follow

  = f.submit class: 'btn btn-primary btn-raised'

```
`form_with`はHTMLとして以下のように出力される。
```html
<form action="/mypage/notification_setting" accept-charset="UTF-8" method="post">
    <input name="utf8" type="hidden" value="✓">
    <input type="hidden" name="_method" value="patch">
    <input type="hidden" name="authenticity_token" value="wQEP4lPAVkdV7MNomZOODoQIfiBbcrNd5+B2N1mNxvqylMgzr1KvxuQ2bFtAOsNlx+TGQ9WWGtebS+C/+56esA==">
    <div class="form-group">
        <input name="user[notification_on_comment]" type="hidden" value="0">
        <input type="checkbox" value="1" checked="checked" name="user[notification_on_comment]" id="user_notification_on_comment">
        <label for="user_notification_on_comment">コメント時の通知メール</label>
    </div>
    <div class="form-group">
        <input name="user[notification_on_like]" type="hidden" value="0">
        <input type="checkbox" value="1" checked="checked" name="user[notification_on_like]" id="user_notification_on_like">
        <label for="user_notification_on_like">いいね時の通知メール</label>
    </div>
    <div class="form-group">
        <input name="user[notification_on_follow]" type="hidden" value="0">
        <input type="checkbox" value="1" name="user[notification_on_follow]" id="user_notification_on_follow">
        <input type="submit" name="commit" value="更新する" class="btn btn-primary btn-raised" data-disable-with="更新する">
        <label for="user_notification_on_follow">フォロー時の通知メール</label>
    </div>
</form>
```
action: アクセス先のURL
method: HTTPメソッド
type: フォームの入力値の種類(text, email, radio, checkboxなど)
name: フォームの名前を示している
value: 値

paramsハッシュの中身は、以下の通りである。
`{ "user"=>{"notification_on_comment"=>"1", "notification_on_like"=>"1", "notification_on_follow"=>"1"} }`
このような形で書くことで、`params[:user]`でUserモデルに紐づく全てのハッシュを取得できる。

# Labelタグについて
ラベルタグを使うと、クリックした際にチェックしたことになる。  
また、ラベルタグはインプットタグと紐付ける。  
紐付けにあたっては、labelのforとvalueを同一にする。

# form_withのオプション

### modelオプション

- modelオプションを使う場合、`form_with`の引数にはモデルクラスのインスタンスを指定する。
- 今回の場合は、通知設定のため`updateアクション`が動くパスに変換されるが、ユーザー登録や編集の場合は、インスタンスがDBに保存されているがどうかで`createアクション`か`updateアクション`を自動的に振り分けてくれる。

### urlオプション
- urlオプションを指定しない場合
```html
<form action="/users/31" accept-charset="UTF-8" method="post">
```
- urlオプションを指定する場合
```html
<form action="/mypage/notification_setting" accept-charset="UTF-8" method="post">
```
urlオプションはHTMLに出力すると、form要素のaction属性に変換され、送信されるデータの送信先を指定する。urlオプションを指定しないと、ユーザーの個別IDを送信先にされてしまうが、今回の通知設定は名前空間の`mypage`にしているのでルーティングエラーが発生してしまうため、urlオプションを指定する必要がある。
- 上記でチェックした通知設定(form要素に`name="user[notification_on_comment]" `としてsubmitされたデータ)は、リクエストパラメータとしてリクエストに添えて送られる。
  このリクエストパラメータは、コントローラーにおいてparamsメソッドを利用して取得する。

# 参考

[【Rails】form_withを完全に理解した - qiita](https://qiita.com/beanzou/items/e4448b8f84b2de63f770)

[formタグのaction,method属性の使い方と特性〜html,slimでの記述方法〜 - qiita](https://qiita.com/mikuhonda/items/f3126380d3340f3d8a2b)

[【第１回】 Railsガイドの「Action View フォームヘルパー」をひたすらまとめていく 【Formの概要編】](https://tech-essentials.work/course_outputs/201)

[【第2回】 Railsガイドの「Action View フォームヘルパー」をひたすらまとめていく 【基本的なフォームを作成する】](https://tech-essentials.work/course_outputs/202)

# 反省

form_withの復習も兼ねてフォームヘルパーをまとめてみた。  
オプションは公式に様々書いてあるので、目を通しておきたい。